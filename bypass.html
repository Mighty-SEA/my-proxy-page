<!DOCTYPE html>
<html>
<head>
    <title>WiFi Bypass Gateway</title>
    <meta charset="UTF-8">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }
        h1 { 
            color: #00ff88;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 0 0 10px rgba(0,255,136,0.3);
        }
        .subtitle {
            text-align: center;
            color: #a0a0c0;
            margin-bottom: 30px;
        }
        .card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #4CAF50;
        }
        .card.error { border-left-color: #ff4444; }
        .card.warning { border-left-color: #ffaa00; }
        .card.info { border-left-color: #2196F3; }
        
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
            text-decoration: none;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        }
        .btn.secondary {
            background: linear-gradient(135deg, #2196F3 0%, #0D47A1 100%);
        }
        .btn.warning {
            background: linear-gradient(135deg, #ff9800 0%, #ef6c00 100%);
        }
        
        .log-box {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            color: #00ff88;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            margin-left: 10px;
        }
        .status.online { background: #4CAF50; }
        .status.offline { background: #f44336; }
        .status.connecting { background: #ff9800; }
        
        .connection-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .info-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
        }
        .info-label {
            color: #a0a0c0;
            font-size: 12px;
            margin-bottom: 5px;
        }
        .info-value {
            font-family: monospace;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîì WiFi Bypass Gateway</h1>
        <p class="subtitle">Using GitHub Pages + Cloudflare Worker to bypass WiFi voucher</p>
        
        <!-- Connection Info -->
        <div class="connection-info">
            <div class="info-item">
                <div class="info-label">GitHub Pages</div>
                <div class="info-value" id="githubHost"></div>
            </div>
            <div class="info-item">
                <div class="info-label">Cloudflare Worker</div>
                <div class="info-value" id="workerUrl"></div>
            </div>
            <div class="info-item">
                <div class="info-label">V2Ray Server</div>
                <div class="info-value">yuz.rmht.my.id:443</div>
            </div>
        </div>
        
        <!-- Step 1: Test GitHub Access -->
        <div class="card info">
            <h2>Step 1: Test GitHub Pages Access</h2>
            <p>We're currently on GitHub Pages (<span id="currentHost"></span>). If you can see this page, GitHub access works!</p>
            <button class="btn" onclick="testGitHub()">‚úÖ Test GitHub Access</button>
            <span id="githubStatus" class="status connecting">Testing...</span>
        </div>
        
        <!-- Step 2: Test Worker -->
        <div class="card info">
            <h2>Step 2: Test Cloudflare Worker</h2>
            <p>Worker acts as proxy between GitHub and V2Ray server.</p>
            <button class="btn secondary" onclick="testWorker()">üîó Test Worker Connection</button>
            <span id="workerStatus" class="status connecting">Waiting...</span>
        </div>
        
        <!-- Step 3: Direct Connection Test -->
        <div class="card warning">
            <h2>Step 3: Test Direct V2Ray Connection</h2>
            <p>Try connecting directly to V2Ray server (may be blocked by firewall).</p>
            <button class="btn warning" onclick="testDirectConnection()">üöÄ Test Direct Connection</button>
            <span id="directStatus" class="status connecting">Not tested</span>
        </div>
        
        <!-- Step 4: Establish Tunnel -->
        <div class="card">
            <h2>Step 4: Establish Proxy Tunnel</h2>
            <p>Create WebSocket tunnel through Worker for full internet access.</p>
            <button class="btn" onclick="startTunnel()">üåê Start Proxy Tunnel</button>
            <button class="btn secondary" onclick="startWebSocket()">üîå WebSocket Mode</button>
            <span id="tunnelStatus" class="status offline">Ready</span>
        </div>
        
        <!-- Connection Log -->
        <div class="card">
            <h2>Connection Log</h2>
            <div id="log" class="log-box">
[SYSTEM] WiFi Bypass Gateway Initialized
[INFO] Running on: GitHub Pages
[INFO] Worker URL: https://bold-dust-7eeb.hibban-habiburrahman-sea.workers.dev
            </div>
            <button class="btn" onclick="clearLog()">Clear Log</button>
        </div>
        
        <!-- Quick Actions -->
        <div style="text-align: center; margin-top: 30px;">
            <button class="btn" onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
            <button class="btn warning" onclick="emergencyBypass()">üö® Emergency Bypass</button>
        </div>
    </div>

    <script>
        // Configuration
        const WORKER_URL = 'https://bold-dust-7eeb.hibban-habiburrahman-sea.workers.dev';
        const V2RAY_SERVER = 'yuz.rmht.my.id';
        const V2RAY_PORT = '443';
        const VMESS_ID = '4c4ff64d-8ce5-4783-84bd-8098ceb826ce';
        
        // DOM Elements
        const logElement = document.getElementById('log');
        const currentHostElement = document.getElementById('currentHost');
        const githubHostElement = document.getElementById('githubHost');
        const workerUrlElement = document.getElementById('workerUrl');
        
        // Initialize
        window.addEventListener('load', function() {
            const hostname = window.location.hostname;
            currentHostElement.textContent = hostname;
            githubHostElement.textContent = hostname;
            workerUrlElement.textContent = WORKER_URL;
            
            addLog('‚úÖ Page loaded successfully');
            addLog('üìç Current location: ' + window.location.href);
            
            // Auto-start basic tests
            setTimeout(testGitHub, 1000);
            setTimeout(testWorker, 2000);
        });
        
        // Logging function
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            logElement.innerHTML = '[LOG CLEARED]\n';
        }
        
        function updateStatus(elementId, status, text) {
            const element = document.getElementById(elementId);
            element.className = 'status ' + status;
            element.textContent = text;
        }
        
        // Test 1: GitHub Access
        async function testGitHub() {
            updateStatus('githubStatus', 'connecting', 'Testing...');
            addLog('Testing GitHub Pages access...');
            
            try {
                // Test if we can access GitHub resources
                const response = await fetch('https://api.github.com', { 
                    mode: 'no-cors',
                    cache: 'no-store'
                });
                
                updateStatus('githubStatus', 'online', 'Accessible ‚úì');
                addLog('‚úÖ GitHub Pages access confirmed');
                addLog('üí° This page can bypass WiFi restrictions');
                return true;
            } catch (error) {
                updateStatus('githubStatus', 'offline', 'Blocked ‚úó');
                addLog('‚ùå GitHub access test failed');
                addLog('‚ö†Ô∏è But we can still load this page, so partial access exists');
                return false;
            }
        }
        
        // Test 2: Worker Connection
        async function testWorker() {
            updateStatus('workerStatus', 'connecting', 'Connecting...');
            addLog('Testing Cloudflare Worker connection...');
            
            try {
                const response = await fetch(WORKER_URL + '/test');
                const data = await response.json();
                
                updateStatus('workerStatus', 'online', 'Connected ‚úì');
                addLog('‚úÖ Worker connection successful');
                addLog('üìä Worker response: ' + JSON.stringify(data, null, 2).substring(0, 200));
                return true;
            } catch (error) {
                updateStatus('workerStatus', 'offline', 'Failed ‚úó');
                addLog('‚ùå Worker connection failed: ' + error.message);
                return false;
            }
        }
        
        // Test 3: Direct V2Ray Connection
        async function testDirectConnection() {
            updateStatus('directStatus', 'connecting', 'Testing...');
            addLog('Testing direct V2Ray connection...');
            
            // Method 1: Simple fetch (no-cors)
            try {
                await fetch(`https://${V2RAY_SERVER}:${V2RAY_PORT}`, {
                    mode: 'no-cors',
                    method: 'HEAD'
                });
                addLog('‚ö†Ô∏è Direct fetch attempted (no-cors mode)');
            } catch (e) {
                addLog('üì° Direct fetch blocked (expected)');
            }
            
            // Method 2: WebSocket
            try {
                const ws = new WebSocket(`wss://${V2RAY_SERVER}:${V2RAY_PORT}/vmess`);
                
                ws.onopen = function() {
                    updateStatus('directStatus', 'online', 'Direct ‚úì');
                    addLog('üéâ DIRECT CONNECTION SUCCESS! No bypass needed!');
                    
                    // Send VMESS config immediately
                    const config = {
                        v: '2',
                        ps: 'Direct-GitHub-Bypass',
                        add: V2RAY_SERVER,
                        port: V2RAY_PORT,
                        id: VMESS_ID,
                        aid: '0',
                        net: 'ws',
                        type: 'none',
                        host: window.location.hostname,
                        path: '/vmess',
                        tls: 'tls',
                        sni: window.location.hostname
                    };
                    
                    ws.send(btoa(JSON.stringify(config)));
                    addLog('‚úÖ VMESS configuration sent directly');
                    
                    // Keep connection
                    window.directConnection = ws;
                };
                
                ws.onerror = function(error) {
                    updateStatus('directStatus', 'offline', 'Blocked ‚úó');
                    addLog('‚ùå Direct WebSocket blocked by firewall');
                    addLog('üí° Will use Worker proxy instead');
                };
                
                // Timeout
                setTimeout(() => {
                    if (ws.readyState === WebSocket.CONNECTING) {
                        updateStatus('directStatus', 'offline', 'Timeout ‚úó');
                        addLog('‚è∞ Direct connection timeout (blocked)');
                        ws.close();
                    }
                }, 5000);
                
            } catch (error) {
                updateStatus('directStatus', 'offline', 'Error ‚úó');
                addLog('‚ùå WebSocket error: ' + error.message);
            }
        }
        
        // Start Proxy Tunnel via Worker
        function startTunnel() {
            updateStatus('tunnelStatus', 'connecting', 'Starting...');
            addLog('Starting proxy tunnel via Worker...');
            
            // Create WebSocket connection to Worker
            const ws = new WebSocket(WORKER_URL.replace('https', 'wss') + '/ws');
            
            ws.onopen = function() {
                updateStatus('tunnelStatus', 'online', 'Tunnel Active ‚úì');
                addLog('‚úÖ Worker WebSocket tunnel established');
                
                // Send VMESS config to Worker
                const config = {
                    v: '2',
                    ps: 'Worker-Tunnel',
                    add: V2RAY_SERVER,
                    port: V2RAY_PORT,
                    id: VMESS_ID,
                    aid: '0',
                    net: 'ws',
                    type: 'none',
                    host: window.location.hostname,
                    path: '/vmess',
                    tls: 'tls',
                    sni: window.location.hostname
                };
                
                ws.send(JSON.stringify({
                    type: 'vmess-connect',
                    config: config,
                    timestamp: new Date().toISOString()
                }));
                
                addLog('üì§ VMESS config sent to Worker');
                addLog('üîß Tunnel ready for data forwarding');
                
                // Store WebSocket for later use
                window.tunnelWS = ws;
            };
            
            ws.onmessage = function(event) {
                addLog('üì® Tunnel message: ' + event.data.substring(0, 100));
            };
            
            ws.onerror = function(error) {
                updateStatus('tunnelStatus', 'offline', 'Failed ‚úó');
                addLog('‚ùå Tunnel error: ' + error);
            };
            
            ws.onclose = function() {
                updateStatus('tunnelStatus', 'offline', 'Closed');
                addLog('üîå Tunnel closed');
            };
        }
        
        // Alternative: Direct WebSocket mode
        function startWebSocket() {
            addLog('Starting WebSocket-only mode...');
            
            // Simple test WebSocket
            const ws = new WebSocket(WORKER_URL.replace('https', 'wss') + '/ws');
            
            ws.onopen = function() {
                addLog('‚úÖ WebSocket connected to Worker');
                ws.send(JSON.stringify({ 
                    type: 'ping', 
                    message: 'Test from GitHub Pages',
                    host: window.location.hostname
                }));
            };
            
            ws.onmessage = function(event) {
                addLog('üì® WS: ' + event.data);
            };
        }
        
        // Run all tests
        function runAllTests() {
            addLog('=== RUNNING ALL TESTS ===');
            testGitHub();
            setTimeout(testWorker, 1000);
            setTimeout(testDirectConnection, 2000);
            setTimeout(() => {
                addLog('=== TESTS COMPLETE ===');
                addLog('Summary:');
                addLog('1. GitHub Access: Required for this page');
                addLog('2. Worker: Proxy gateway');
                addLog('3. Direct: Likely blocked (use Worker tunnel)');
                addLog('4. Tunnel: Click "Start Proxy Tunnel" to begin');
            }, 4000);
        }
        
        // Emergency bypass - simplest method
        function emergencyBypass() {
            addLog('üö® EMERGENCY BYPASS ACTIVATED');
            addLog('Attempting simplest possible connection...');
            
            // Try the most basic connection
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.srcdoc = `
                <script>
                    // Try to connect from within iframe
                    const ws = new WebSocket('wss://${V2RAY_SERVER}:${V2RAY_PORT}/vmess');
                    ws.onopen = () => {
                        parent.postMessage({type: 'connected', ws: 'direct'}, '*');
                        const config = {
                            v: '2', add: '${V2RAY_SERVER}', port: '${V2RAY_PORT}',
                            id: '${VMESS_ID}', aid: '0', net: 'ws',
                            host: '${window.location.hostname}', path: '/vmess', tls: 'tls'
                        };
                        ws.send(btoa(JSON.stringify(config)));
                    };
                    ws.onerror = () => {
                        parent.postMessage({type: 'failed', method: 'direct'}, '*');
                    };
                <\/script>
            `;
            document.body.appendChild(iframe);
            
            // Listen for messages from iframe
            window.addEventListener('message', (event) => {
                if (event.data.type === 'connected') {
                    addLog('üéâ EMERGENCY BYPASS SUCCESS! Direct connection from iframe');
                }
            });
        }
    </script>
</body>
</html>
