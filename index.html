<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîì WiFi Bypass - Tanpa Voucher</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîì</text></svg>">
    <style>
        :root {
            --primary: #00d4aa;
            --secondary: #0099ff;
            --dark: #0a192f;
            --darker: #020c1b;
            --light: #ccd6f6;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff4444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--light);
            min-height: 100vh;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(90deg, rgba(0,212,170,0.1) 0%, rgba(0,153,255,0.1) 100%);
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(0,212,170,0.2);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0,212,170,0.3);
        }
        
        .tagline {
            font-size: 1.2rem;
            color: #8892b0;
            margin-bottom: 20px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(0,212,170,0.2);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .stat-title {
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }
        
        .control-panel {
            background: rgba(255,255,255,0.03);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #00b894);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,212,170,0.3);
        }
        
        .btn-secondary {
            background: rgba(0,153,255,0.2);
            color: var(--secondary);
            border: 1px solid rgba(0,153,255,0.3);
        }
        
        .btn-secondary:hover {
            background: rgba(0,153,255,0.3);
            transform: translateY(-3px);
        }
        
        .btn-warning {
            background: rgba(255,170,0,0.2);
            color: var(--warning);
            border: 1px solid rgba(255,170,0,0.3);
        }
        
        .btn-danger {
            background: rgba(255,68,68,0.2);
            color: var(--danger);
            border: 1px solid rgba(255,68,68,0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online { background: var(--success); box-shadow: 0 0 10px var(--success); }
        .status-offline { background: var(--danger); }
        .status-connecting { background: var(--warning); animation: pulse 1.5s infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .log-container {
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .log-box {
            background: #0a192f;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            height: 400px;
            overflow-y: auto;
            color: #8892b0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding-left: 10px;
            border-left: 3px solid transparent;
        }
        
        .log-info { border-left-color: var(--secondary); }
        .log-success { border-left-color: var(--success); color: var(--success); }
        .log-warning { border-left-color: var(--warning); color: var(--warning); }
        .log-error { border-left-color: var(--danger); color: var(--danger); }
        
        .connection-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .node {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            min-width: 150px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .node-active {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0,212,170,0.3);
        }
        
        .arrow {
            font-size: 2rem;
            color: var(--primary);
        }
        
        footer {
            text-align: center;
            padding: 30px;
            margin-top: 50px;
            color: #8892b0;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .btn { padding: 12px 20px; }
            .connection-diagram { flex-direction: column; }
            .arrow { transform: rotate(90deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>üîì WiFi Bypass Gateway</h1>
            <p class="tagline">Akses internet tanpa voucher melalui GitHub Pages + Cloudflare Worker</p>
            <div class="status-indicator status-online"></div>
            <span id="globalStatus">System Ready</span>
        </header>
        
        <!-- Stats -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-icon">üåê</div>
                <div class="stat-title">GitHub Pages</div>
                <div class="stat-value" id="githubUrl">mighty-sea.github.io</div>
                <div class="status-indicator status-online"></div>
                <span>Accessible</span>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">‚ö°</div>
                <div class="stat-title">Cloudflare Worker</div>
                <div class="stat-value" id="workerUrl">bold-dust-7eeb.workers.dev</div>
                <div class="status-indicator status-connecting"></div>
                <span id="workerStatus">Testing...</span>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">üöÄ</div>
                <div class="stat-title">V2Ray Server</div>
                <div class="stat-value">yuz.rmht.my.id:443</div>
                <div class="status-indicator status-offline"></div>
                <span id="v2rayStatus">Not connected</span>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">üîë</div>
                <div class="stat-title">VMESS ID</div>
                <div class="stat-value">4c4ff64d-8ce5...</div>
                <div class="status-indicator status-online"></div>
                <span>Valid until 2025-12-15</span>
            </div>
        </div>
        
        <!-- Connection Diagram -->
        <div class="connection-diagram">
            <div class="node node-active" id="node1">
                <div>üì±</div>
                <strong>Your Device</strong>
                <div style="font-size:0.9rem;margin-top:5px;">WiFi (No Voucher)</div>
            </div>
            
            <div class="arrow">‚û°Ô∏è</div>
            
            <div class="node" id="node2">
                <div>üêô</div>
                <strong>GitHub Pages</strong>
                <div style="font-size:0.9rem;margin-top:5px;">Bypass Point</div>
            </div>
            
            <div class="arrow">‚û°Ô∏è</div>
            
            <div class="node" id="node3">
                <div>‚ö°</div>
                <strong>Cloudflare Worker</strong>
                <div style="font-size:0.9rem;margin-top:5px;">Proxy Gateway</div>
            </div>
            
            <div class="arrow">‚û°Ô∏è</div>
            
            <div class="node" id="node4">
                <div>üöÄ</div>
                <strong>V2Ray Server</strong>
                <div style="font-size:0.9rem;margin-top:5px;">Singapore</div>
            </div>
            
            <div class="arrow">‚û°Ô∏è</div>
            
            <div class="node" id="node5">
                <div>üåç</div>
                <strong>Internet</strong>
                <div style="font-size:0.9rem;margin-top:5px;">Full Access</div>
            </div>
        </div>
        
        <!-- Control Panel -->
        <div class="control-panel">
            <h2 class="section-title">‚öôÔ∏è Control Panel</h2>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="runQuickTest()">
                    <span>‚ñ∂Ô∏è</span> Quick Test
                </button>
                
                <button class="btn btn-secondary" onclick="testWorkerConnection()">
                    <span>üîó</span> Test Worker
                </button>
                
                <button class="btn btn-secondary" onclick="testDirectV2Ray()">
                    <span>üöÄ</span> Test Direct V2Ray
                </button>
                
                <button class="btn btn-warning" onclick="startWebSocketTunnel()">
                    <span>üîå</span> Start WebSocket Tunnel
                </button>
                
                <button class="btn btn-primary" onclick="startFullProxy()">
                    <span>üåê</span> Start Full Proxy
                </button>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="copyVMESSConfig()">
                    <span>üìã</span> Copy VMESS Config
                </button>
                
                <button class="btn btn-secondary" onclick="testInternet()">
                    <span>üì°</span> Test Internet Access
                </button>
                
                <button class="btn btn-danger" onclick="emergencyMode()">
                    <span>üö®</span> Emergency Mode
                </button>
                
                <button class="btn" onclick="clearLogs()" style="background:rgba(255,255,255,0.1);">
                    <span>üóëÔ∏è</span> Clear Logs
                </button>
            </div>
        </div>
        
        <!-- Log Container -->
        <div class="log-container">
            <div class="log-header">
                <h2 class="section-title">üìù Connection Log</h2>
                <div>
                    <span id="logCount">0</span> entries
                </div>
            </div>
            <div class="log-box" id="logBox">
[SYSTEM] WiFi Bypass Gateway Initialized
[INFO] Running on: GitHub Pages (mighty-sea.github.io)
[INFO] Worker: https://bold-dust-7eeb.hibban-habiburrahman-sea.workers.dev
[INFO] V2Ray Server: yuz.rmht.my.id:443
[INFO] Click "Quick Test" to begin
            </div>
        </div>
        
        <!-- Footer -->
        <footer>
            <p>üîì WiFi Bypass Gateway | GitHub Pages + Cloudflare Worker + V2Ray</p>
            <p>Note: Use for educational purposes only. Follow local regulations.</p>
            <p>Status: <span id="footerStatus">Ready</span> | Updated: <span id="timestamp"></span></p>
        </footer>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            workerUrl: 'https://bold-dust-7eeb.hibban-habiburrahman-sea.workers.dev',
            v2rayServer: 'yuz.rmht.my.id',
            v2rayPort: '443',
            vmessId: '4c4ff64d-8ce5-4783-84bd-8098ceb826ce',
            githubUrl: 'https://mighty-sea.github.io/my-proxy-page/'
        };
        
        // State
        let state = {
            workerConnected: false,
            v2rayConnected: false,
            tunnelActive: false,
            logs: [],
            webSocket: null
        };
        
        // DOM Elements
        const logBox = document.getElementById('logBox');
        const logCount = document.getElementById('logCount');
        const timestamp = document.getElementById('timestamp');
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set timestamp
            timestamp.textContent = new Date().toLocaleString();
            
            // Set URLs
            document.getElementById('githubUrl').textContent = window.location.hostname;
            document.getElementById('workerUrl').textContent = new URL(CONFIG.workerUrl).hostname;
            
            // Auto-test after 2 seconds
            setTimeout(() => {
                logInfo('System initialized. Auto-testing connections...');
                testWorkerConnection();
            }, 2000);
            
            // Update timestamp every minute
            setInterval(() => {
                timestamp.textContent = new Date().toLocaleString();
            }, 60000);
        });
        
        // Logging functions
        function logInfo(message) {
            addLog('INFO', message);
            console.info('‚ÑπÔ∏è ' + message);
        }
        
        function logSuccess(message) {
            addLog('SUCCESS', message);
            console.log('‚úÖ ' + message);
        }
        
        function logWarning(message) {
            addLog('WARNING', message);
            console.warn('‚ö†Ô∏è ' + message);
        }
        
        function logError(message) {
            addLog('ERROR', message);
            console.error('‚ùå ' + message);
        }
        
        function addLog(type, message) {
            const time = new Date().toLocaleTimeString();
            const entry = {
                time,
                type,
                message,
                id: Date.now()
            };
            
            state.logs.unshift(entry); // Add to beginning
            
            // Update log display (show last 50 entries)
            const displayLogs = state.logs.slice(0, 50);
            logBox.innerHTML = displayLogs.map(log => 
                `<div class="log-entry log-${log.type.toLowerCase()}">
                    [${log.time}] ${log.type}: ${log.message}
                </div>`
            ).join('');
            
            logCount.textContent = state.logs.length;
            
            // Auto-scroll to top
            logBox.scrollTop = 0;
        }
        
        function clearLogs() {
            state.logs = [];
            logBox.innerHTML = '[LOGS CLEARED]';
            logCount.textContent = '0';
            logInfo('Logs cleared');
        }
        
        // Update status indicators
        function updateStatus() {
            // Worker status
            const workerStatusEl = document.getElementById('workerStatus');
            const workerNode = document.getElementById('node3');
            
            if (state.workerConnected) {
                workerStatusEl.textContent = 'Connected';
                workerNode.classList.add('node-active');
                updateNodeStatus(3, 'online');
            } else {
                workerStatusEl.textContent = 'Disconnected';
                workerNode.classList.remove('node-active');
                updateNodeStatus(3, 'offline');
            }
            
            // V2Ray status
            const v2rayStatusEl = document.getElementById('v2rayStatus');
            const v2rayNode = document.getElementById('node4');
            
            if (state.v2rayConnected) {
                v2rayStatusEl.textContent = 'Connected';
                v2rayNode.classList.add('node-active');
                updateNodeStatus(4, 'online');
            } else {
                v2rayStatusEl.textContent = 'Not connected';
                v2rayNode.classList.remove('node-active');
                updateNodeStatus(4, 'offline');
            }
            
            // Tunnel status
            const internetNode = document.getElementById('node5');
            if (state.tunnelActive) {
                internetNode.classList.add('node-active');
                updateNodeStatus(5, 'online');
            } else {
                internetNode.classList.remove('node-active');
                updateNodeStatus(5, 'offline');
            }
        }
        
        function updateNodeStatus(nodeNum, status) {
            const node = document.getElementById('node' + nodeNum);
            const indicator = node.querySelector('.status-indicator') || 
                             (() => { const div = document.createElement('div'); 
                                      div.className = 'status-indicator'; 
                                      node.appendChild(div); 
                                      return div; })();
            
            indicator.className = 'status-indicator status-' + status;
        }
        
        // Test Worker connection
        async function testWorkerConnection() {
            logInfo('Testing Cloudflare Worker connection...');
            updateNodeStatus(3, 'connecting');
            
            try {
                const response = await fetch(CONFIG.workerUrl + '/test', {
                    signal: AbortSignal.timeout(10000)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    state.workerConnected = true;
                    logSuccess(`Worker connected: ${data.message}`);
                    logInfo(`Worker IP: ${data.your_ip || 'unknown'}`);
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                state.workerConnected = false;
                logError(`Worker connection failed: ${error.message}`);
            }
            
            updateStatus();
            return state.workerConnected;
        }
        
        // Test direct V2Ray connection
        async function testDirectV2Ray() {
            logInfo('Testing direct V2Ray connection...');
            updateNodeStatus(4, 'connecting');
            
            // Try WebSocket connection
            try {
                const ws = new WebSocket(`wss://${CONFIG.v2rayServer}:${CONFIG.v2rayPort}/vmess`);
                
                return new Promise((resolve) => {
                    ws.onopen = () => {
                        state.v2rayConnected = true;
                        logSuccess('Direct V2Ray connection successful!');
                        logInfo('No bypass needed - direct connection works');
                        
                        // Send VMESS config
                        const config = {
                            v: '2',
                            ps: 'Direct-GitHub-Bypass',
                            add: CONFIG.v2rayServer,
                            port: CONFIG.v2rayPort,
                            id: CONFIG.vmessId,
                            aid: '0',
                            net: 'ws',
                            type: 'none',
                            host: window.location.hostname,
                            path: '/vmess',
                            tls: 'tls',
                            sni: window.location.hostname
                        };
                        
                        ws.send(btoa(JSON.stringify(config)));
                        ws.close();
                        
                        updateStatus();
                        resolve(true);
                    };
                    
                    ws.onerror = () => {
                        state.v2rayConnected = false;
                        logWarning('Direct V2Ray connection blocked (expected)');
                        logInfo('Will use Worker proxy instead');
                        updateStatus();
                        resolve(false);
                    };
                    
                    // Timeout after 5 seconds
                    setTimeout(() => {
                        if (ws.readyState === WebSocket.CONNECTING) {
                            ws.close();
                            state.v2rayConnected = false;
                            logWarning('Direct connection timeout');
                            updateStatus();
                            resolve(false);
                        }
                    }, 5000);
                });
                
            } catch (error) {
                state.v2rayConnected = false;
                logError(`WebSocket error: ${error.message}`);
                updateStatus();
                return false;
            }
        }
        
        // Start WebSocket tunnel via Worker
        function startWebSocketTunnel() {
            if (!state.workerConnected) {
                logError('Worker not connected. Test Worker first.');
                return;
            }
            
            logInfo('Starting WebSocket tunnel via Worker...');
            
            // Close existing WebSocket
            if (state.webSocket) {
                state.webSocket.close();
            }
            
            // Create new WebSocket connection to Worker
            const wsUrl = CONFIG.workerUrl.replace('https://', 'wss://') + '/ws';
            const ws = new WebSocket(wsUrl);
            
            ws.onopen = () => {
                logSuccess('WebSocket tunnel established with Worker');
                state.webSocket = ws;
                state.tunnelActive = true;
                
                // Send ping to test
                ws.send(JSON.stringify({
                    type: 'ping',
                    message: 'Hello from GitHub Bypass',
                    timestamp: new Date().toISOString(),
                    host: window.location.hostname
                }));
                
                updateStatus();
            };
            
            ws.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    logInfo(`Worker message: ${data.type || 'unknown'}`);
                    
                    if (data.type === 'pong') {
                        logSuccess('Worker WebSocket responsive');
                    }
                } catch {
                    logInfo(`Worker raw: ${event.data.substring(0, 100)}`);
                }
            };
            
            ws.onerror = (error) => {
                logError('WebSocket tunnel error');
                state.tunnelActive = false;
                updateStatus();
            };
            
            ws.onclose = () => {
                logWarning('WebSocket tunnel closed');
                state.tunnelActive = false;
                updateStatus();
            };
        }
        
        // Start full proxy (simulated)
        async function startFullProxy() {
            logInfo('Starting full proxy tunnel...');
            
            // Step 1: Ensure Worker is connected
            if (!await testWorkerConnection()) {
                logError('Cannot start proxy: Worker unavailable');
                return;
            }
            
            // Step 2: Start WebSocket tunnel
            startWebSocketTunnel();
            
            // Step 3: Simulate proxy setup
            setTimeout(() => {
                if (state.tunnelActive) {
                    logSuccess('Proxy tunnel established!');
                    logInfo('Traffic flow: Device ‚Üí GitHub ‚Üí Worker ‚Üí V2Ray ‚Üí Internet');
                    logInfo('You should now have internet access through the tunnel');
                    
                    // Test internet access
                    testInternet();
                }
            }, 2000);
        }
        
        // Test internet access
        async function testInternet() {
            logInfo('Testing internet access...');
            
            // Try to access a test site through our setup
            const testUrls = [
                'https://httpbin.org/ip',
                'https://api.ipify.org?format=json',
                'https://www.google.com/gen_204'
            ];
            
            for (const url of testUrls) {
                try {
                    // Use no-cors mode to avoid CORS issues
                    await fetch(url, { mode: 'no-cors', cache: 'no-store' });
                    logSuccess(`Can reach: ${new URL(url).hostname}`);
                    return true;
                } catch (error) {
                    logWarning(`Cannot reach: ${new URL(url).hostname}`);
                }
            }
            
            logWarning('Limited internet access detected');
            return false;
        }
        
        // Quick test all connections
        async function runQuickTest() {
            logInfo('=== QUICK TEST STARTED ===');
            
            // Test Worker
            const workerOk = await testWorkerConnection();
            
            // Test V2Ray
            const v2rayOk = await testDirectV2Ray();
            
            // Start tunnel if Worker works but V2Ray doesn't
            if (workerOk && !v2rayOk) {
                logInfo('Starting automatic bypass tunnel...');
                startWebSocketTunnel();
            }
            
            logInfo('=== QUICK TEST COMPLETE ===');
            logInfo(`Worker: ${workerOk ? '‚úÖ' : '‚ùå'}`);
            logInfo(`V2Ray Direct: ${v2rayOk ? '‚úÖ' : '‚ùå'}`);
            logInfo(`Tunnel: ${state.tunnelActive ? '‚úÖ Active' : '‚ùå Inactive'}`);
        }
        
        // Copy VMESS config to clipboard
        function copyVMESSConfig() {
            const config = {
                v: '2',
                ps: 'GitHub-Bypass-Config',
                add: CONFIG.v2rayServer,
                port: CONFIG.v2rayPort,
                id: CONFIG.vmessId,
                aid: '0',
                net: 'ws',
                type: 'none',
                host: window.location.hostname,
                path: '/vmess',
                tls: 'tls',
                sni: window.location.hostname
            };
            
            const encoded = btoa(JSON.stringify(config, null, 2));
            const vmessLink = `vmess://${encoded}`;
            
            navigator.clipboard.writeText(vmessLink).then(() => {
                logSuccess('VMESS config copied to clipboard!');
                logInfo('Paste into V2Ray client like v2rayNG, V2RayN, etc.');
            }).catch(err => {
                logError('Failed to copy: ' + err.message);
            });
        }
        
        // Emergency mode - try everything
        function emergencyMode() {
            logInfo('üö® EMERGENCY MODE ACTIVATED');
            logInfo('Trying all possible bypass methods...');
            
            // Method 1: Direct WebSocket
            try {
                const ws = new WebSocket(`wss://${CONFIG.v2rayServer}:${CONFIG.v2rayPort}/vmess`);
                ws.onopen = () => {
                    logSuccess('EMERGENCY: Direct connection works!');
                    const config = {
                        v: '2', add: CONFIG.v2rayServer, port: CONFIG.v2rayPort,
                        id: CONFIG.vmessId, aid: '0', net: 'ws',
                        host: window.location.hostname, path: '/vmess', tls: 'tls'
                    };
                    ws.send(btoa(JSON.stringify(config)));
                };
            } catch (e) {}
            
            // Method 2: Iframe proxy
            setTimeout(() => {
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.srcdoc = `
                    <script>
                        // Try from iframe context
                        const ws = new WebSocket('wss://${CONFIG.v2rayServer}:${CONFIG.v2rayPort}/vmess');
                        ws.onopen = () => parent.postMessage({type: 'emergency_success'}, '*');
                    <\/script>
                `;
                document.body.appendChild(iframe);
            }, 1000);
            
            // Listen for iframe success
            window.addEventListener('message', (event) => {
                if (event.data.type === 'emergency_success') {
                    logSuccess('EMERGENCY: Iframe proxy works!');
                }
            });
        }
        
        // Expose functions to global scope for button clicks
        window.runQuickTest = runQuickTest;
        window.testWorkerConnection = testWorkerConnection;
        window.testDirectV2Ray = testDirectV2Ray;
        window.startWebSocketTunnel = startWebSocketTunnel;
        window.startFullProxy = startFullProxy;
        window.copyVMESSConfig = copyVMESSConfig;
        window.testInternet = testInternet;
        window.emergencyMode = emergencyMode;
        window.clearLogs = clearLogs;
    </script>
</body>
</html>
